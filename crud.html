<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Excel CRUD App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- SheetJS -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body class="bg-light">

<div class="container mt-5">
  <h2 class="text-center mb-4">Excel CRUD System</h2>

  <div class="d-flex justify-content-between mb-3">
    <input type="file" id="fileInput" accept=".xlsx" class="form-control w-50">
    <button class="btn btn-success" id="addRowBtn">‚ûï Add Row</button>
    <button class="btn btn-primary" id="exportBtn">üíæ Export to Excel</button>
  </div>

  <div class="table-responsive">
    <table class="table table-bordered table-striped text-center align-middle" id="excelTable">
      <thead class="table-dark">
        <tr id="tableHeader"></tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>

<script>
let excelData = [];
let headers = [];

// Load Excel file (default or uploaded)
async function loadExcelFromFile(file) {
  const arrayBuffer = await file.arrayBuffer();
  const workbook = XLSX.read(arrayBuffer, { type: "array" });
  const sheetName = workbook.SheetNames[0];
  const sheet = workbook.Sheets[sheetName];
  excelData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
  renderTable();
}

// Render the Excel data into HTML table
function renderTable() {
  const headerRow = document.getElementById("tableHeader");
  const body = document.getElementById("tableBody");
  headerRow.innerHTML = "";
  body.innerHTML = "";

  if (excelData.length === 0) return;

  headers = excelData[0];
  headers.forEach(h => {
    const th = document.createElement("th");
    th.textContent = h;
    headerRow.appendChild(th);
  });
  const thActions = document.createElement("th");
  thActions.textContent = "Actions";
  headerRow.appendChild(thActions);

  for (let i = 1; i < excelData.length; i++) {
    const row = document.createElement("tr");
    excelData[i].forEach((cell, j) => {
      const td = document.createElement("td");
      td.contentEditable = "true";
      td.textContent = cell;
      row.appendChild(td);
    });

    const tdActions = document.createElement("td");
    tdActions.innerHTML = `
      <button class="btn btn-sm btn-warning me-1" onclick="editRow(${i})">‚úèÔ∏è Edit</button>
      <button class="btn btn-sm btn-danger" onclick="deleteRow(${i})">üóëÔ∏è Delete</button>
    `;
    row.appendChild(tdActions);
    body.appendChild(row);
  }
}

// Add a new row
function addRow() {
  if (headers.length === 0) {
    headers = ["Column1", "Column2", "Column3"];
    excelData.push(headers);
  }
  const newRow = headers.map(() => "");
  excelData.push(newRow);
  renderTable();
}

// Edit row (just alert confirmation)
function editRow(index) {
  alert(`Row ${index} is editable directly. Make changes in the table.`);
}

// Delete row
function deleteRow(index) {
  if (confirm("Delete this row?")) {
    excelData.splice(index, 1);
    renderTable();
  }
}

// Export table back to Excel
function exportToExcel() {
  const ws = XLSX.utils.aoa_to_sheet(excelData);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
  XLSX.writeFile(wb, "updated_data.xlsx");
}

// Event listeners
document.getElementById("fileInput").addEventListener("change", e => {
  const file = e.target.files[0];
  if (file) loadExcelFromFile(file);
});
document.getElementById("addRowBtn").addEventListener("click", addRow);
document.getElementById("exportBtn").addEventListener("click", exportToExcel);

// Optional: Load default Excel (data.xlsx) if exists on same path
fetch("data.xlsx")
  .then(res => res.ok ? res.arrayBuffer() : null)
  .then(buf => {
    if (buf) {
      const wb = XLSX.read(buf, { type: "array" });
      const sheet = wb.Sheets[wb.SheetNames[0]];
      excelData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
      renderTable();
    }
  });
</script>

</body>
  </html>
