<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Device Inventory (Firestore CRUD)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background-color: #f8f9fa; font-size: 0.95rem; }
    .navbar-brand { font-weight: 600; }
    .container { padding-top: 15px; }
    .item-card { border-left: 4px solid #0d6efd; padding: 10px; cursor: pointer; transition: all 0.2s ease; }
    .item-card:hover { background-color: #f1f3f5; transform: scale(1.01); }
    .item-card h5 { font-size: 1rem; margin-bottom: 5px; }
    .search-bar { max-width: 500px; margin: 10px auto; }
    .btn-sm { padding: 2px 6px; font-size: 0.8rem; }
  </style>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
  <div class="container-fluid px-3">
    <a class="navbar-brand fw-semibold" href="devices1.html">ğŸ–¥ï¸ IT Inventory</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMenu">
      <ul class="navbar-nav ms-auto small" id="navLinks">
        <li class="nav-item"><a href="devices1.html" class="nav-link">ğŸ“‹ See Issues</a></li>
        <li class="nav-item"><a href="inventory.html" class="nav-link">ğŸ’¾ Inventory</a></li>
        <li class="nav-item"><a href="edit-inventory.html" class="nav-link">âœï¸ Edit Inventory</a></li>
        <li class="nav-item"><a href="issue-logger1.html" class="nav-link">ğŸ§¾ Add Issues</a></li>
                 <li class="nav-item"><a href="sysinfo.html" class="nav-link">ğŸ§¾ Client Inventory</a></li>

      </ul>
    </div>
  </div>
</nav>

  <!-- Main -->
  <div class="container">
    <div class="input-group search-bar">
      <span class="input-group-text bg-primary text-white py-1 px-2">ğŸ”</span>
      <input type="text" id="searchInput" class="form-control py-1" placeholder="Search inventory..." />
    </div>
    <h6 id="pageTitle" class="text-center text-secondary mb-3"></h6>
    <div id="inventoryContainer" class="row g-2 justify-content-center"></div>
  </div>

  <!-- Add/Edit Device Modal -->
  <div class="modal fade" id="deviceModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white py-2">
          <h5 class="modal-title" id="deviceModalLabel">Add Device</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <form id="deviceForm" class="modal-body small">
          <input type="hidden" id="deviceId" />
          <div class="row g-2">
            <div class="col-md-6">
              <label class="form-label">Manufacturer</label>
              <input type="text" id="manufacturer" class="form-control form-control-sm" required />
            </div>
            <div class="col-md-6">
              <label class="form-label">Model</label>
              <input type="text" id="model" class="form-control form-control-sm" required />
            </div>
            <div class="col-md-6">
              <label class="form-label">Serial Number</label>
              <input type="text" id="serialNumber" class="form-control form-control-sm" />
            </div>
            <div class="col-md-3">
              <label class="form-label">RAM</label>
              <input type="text" id="ram" class="form-control form-control-sm" />
            </div>
            <div class="col-md-3">
              <label class="form-label">Storage</label>
              <input type="text" id="storage" class="form-control form-control-sm" />
            </div>
            <div class="col-md-6">
              <label class="form-label">Processor</label>
              <input type="text" id="processor" class="form-control form-control-sm" />
            </div>
            <div class="col-12">
              <label class="form-label">Quick Check</label>
              <textarea id="quickCheck" rows="3" class="form-control form-control-sm"></textarea>
            </div>
          </div>
          <div class="mt-3 text-end">
            <button type="submit" class="btn btn-primary btn-sm">ğŸ’¾ Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Firebase & Firestore -->
  <script type="module">
    import {
      initializeApp
    } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      onSnapshot,
      updateDoc,
      deleteDoc,
      doc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyA5ezNWECVn4vkdEHWhap-mv1B-D8LCN70",
      authDomain: "quiz-43b3e.firebaseapp.com",
      projectId: "quiz-43b3e",
      storageBucket: "quiz-43b3e.appspot.com",
      messagingSenderId: "477037762591",
      appId: "1:477037762591:web:ea30670a704b0063819d2a",
      measurementId: "G-7RWKDV2SLP",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const inventoryRef = collection(db, "inventory");

    // DOM elements
    const inventoryContainer = document.getElementById("inventoryContainer");
    const searchInput = document.getElementById("searchInput");
    const addDeviceBtn = document.getElementById("addDeviceBtn");
    const deviceModal = new bootstrap.Modal(document.getElementById("deviceModal"));
    const form = document.getElementById("deviceForm");
    let inventory = [];

    // Realtime listener
    onSnapshot(inventoryRef, (snapshot) => {
      inventory = snapshot.docs.map((d) => ({ id: d.id, ...d.data() }));
      renderInventory();
    });

    // Render inventory cards
    function renderInventory(filterText = "") {
      inventoryContainer.innerHTML = "";
      let filtered = inventory.filter((i) => {
        const text = filterText.toLowerCase();
        return (
          i.manufacturer?.toLowerCase().includes(text) ||
          i.model?.toLowerCase().includes(text) ||
          i.serialNumber?.toLowerCase().includes(text) ||
          i.processor?.toLowerCase().includes(text)
        );
      });

      if (filtered.length === 0) {
        inventoryContainer.innerHTML =
          `<p class="text-center text-muted mt-3">No devices found.</p>`;
        return;
      }

      filtered.forEach((item) => {
        const div = document.createElement("div");
        div.className = "col-12 col-md-6 col-lg-4";
        div.innerHTML = `
          <div class="card item-card shadow-sm">
            <h5 class="text-primary">${item.model}</h5>
            <p><strong>Manufacturer:</strong> ${item.manufacturer}</p>
            <p><strong>Serial:</strong> ${item.serialNumber || "N/A"}</p>
            <p class="small text-muted">Quick Check: ${item.quickCheck || "N/A"}</p>
            <div class="text-end">
              <button class="btn btn-sm btn-outline-primary me-1" onclick="editDevice('${item.id}')">âœï¸ Edit</button>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteDevice('${item.id}')">ğŸ—‘ï¸ Delete</button>
            </div>
          </div>`;
        inventoryContainer.appendChild(div);
      });
    }

    // Add new device
    addDeviceBtn.addEventListener("click", () => {
      form.reset();
      document.getElementById("deviceId").value = "";
      document.getElementById("deviceModalLabel").textContent = "Add Device";
      deviceModal.show();
    });

    // Save (Create or Update)
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = document.getElementById("deviceId").value;
      const data = {
        manufacturer: document.getElementById("manufacturer").value,
        model: document.getElementById("model").value,
        serialNumber: document.getElementById("serialNumber").value,
        ram: document.getElementById("ram").value,
        storage: document.getElementById("storage").value,
        processor: document.getElementById("processor").value,
        quickCheck: document.getElementById("quickCheck").value,
        modifiedAt: serverTimestamp(),
      };

      try {
        if (id) {
          await updateDoc(doc(db, "inventory", id), data);
        } else {
          await addDoc(inventoryRef, {
            ...data,
            createdAt: serverTimestamp(),
            modifiedAt: serverTimestamp(),
          });
        }
        deviceModal.hide();
      } catch (err) {
        console.error("Error saving document:", err);
      }
    });

    // Edit
    window.editDevice = (id) => {
      const item = inventory.find((i) => i.id === id);
      if (!item) return;
      document.getElementById("deviceModalLabel").textContent = "Edit Device";
      document.getElementById("deviceId").value = id;
      document.getElementById("manufacturer").value = item.manufacturer || "";
      document.getElementById("model").value = item.model || "";
      document.getElementById("serialNumber").value = item.serialNumber || "";
      document.getElementById("ram").value = item.ram || "";
      document.getElementById("storage").value = item.storage || "";
      document.getElementById("processor").value = item.processor || "";
      document.getElementById("quickCheck").value = item.quickCheck || "";
      deviceModal.show();
    };

    // Delete
    window.deleteDevice = async (id) => {
      if (confirm("Are you sure you want to delete this device?")) {
        try {
          await deleteDoc(doc(db, "inventory", id));
        } catch (err) {
          console.error("Error deleting document:", err);
        }
      }
    };

    // Search
    searchInput.addEventListener("input", (e) =>
      renderInventory(e.target.value)
    );
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


